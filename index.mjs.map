{"version":3,"file":"index.mjs","sources":["src/index.js"],"sourcesContent":["import React from 'react'\nimport ref from 'referential'\nimport akasha from 'akasha'\n\nexport let RefContext = React.createContext(ref({}))\n\nlet lock = false\n\nexport default class RefProvider extends React.Component {\n  constructor(props) {\n    super(props)\n\n    let data = props.data\n    if (!data && typeof window != 'undefined') {\n      data = akasha.get('data')\n    }\n\n    this.state = {\n      value: {\n        data: ref(data)\n      },\n      appIsMounted: false\n    };\n\n    this.state.value.data.on('set', () => {\n      if (typeof window != undefined) {\n        akasha.set('data', this.state.value.data.get())\n      }\n\n      if (lock) {\n        return\n      }\n\n      lock = true\n\n      requestAnimationFrame(() => {\n        lock = false\n        this.setState({\n          value: {\n            data: this.state.value.data\n          }\n        })\n      })\n    })\n  }\n\n  componentDidMount() {\n    console.log('Ref Provider Mounted')\n    this.setState({ appIsMounted: true });\n  }\n\n  render() {\n    let newProps = Object.assign({}, this.props)\n\n    return <RefContext.Provider value={ this.state.value }>\n        { this.state.appIsMounted ? (\n            this.props.children\n          ) : (\n            <div />\n          )\n        }\n      </RefContext.Provider>\n  }\n}\n\nexport let watch = (key) => {\n  return (WrappedComponent) => {\n    return class WatchedComponent extends React.Component {\n      constructor(props) {\n        super(props)\n      }\n\n      componentWillUnmount() {\n        if (this.data) {\n          this.data.destroy()\n        }\n      }\n\n      render() {\n        let props = this.props\n        let newProps = Object.assign({}, props)\n\n        return (\n          <RefContext.Consumer>\n            { ({ data }) => {\n              // prioritize props.data over context data field\n              let contextData = data\n              if (this.data) {\n                contextData = this.data\n              } else if (props.data) {\n                contextData = props.data\n              }\n\n              // avoid duplication\n              if (!this.data) {\n                // key essentially namespaces the data, either namespace the\n                // context free one from the Ref context or a contexualized one\n                // from props\n                if (key) {\n                  if (props.data) {\n                    contextData = this.data = props.data.ref(key)\n                  } else {\n                    contextData = this.data = data.ref(key)\n                  }\n                }\n              }\n\n              return <WrappedComponent {...newProps} rootData={ data } data={ contextData } />\n            }}\n          </RefContext.Consumer>\n        )\n      }\n    }\n  }\n}\n"],"names":["RefContext","React","createContext","ref","lock","RefProvider","props","data","window","akasha","get","state","value","appIsMounted","on","undefined","set","requestAnimationFrame","setState","console","log","newProps","Object","assign","children","Component","watch","key","WrappedComponent","destroy","contextData"],"mappings":"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"}