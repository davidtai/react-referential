{"version":3,"file":"index.mjs","sources":["src/index.js"],"sourcesContent":["import React from 'react'\nimport ref from 'referential'\nimport akasha from 'akasha'\n\nexport let RefContext = React.createContext(ref({}))\n\nlet lock = false\n\nexport default class RefProvider extends React.Component {\n  constructor(props) {\n    super(props)\n\n    let data = props.data\n    if (!data && typeof window != 'undefined') {\n      data = akasha.get('data')\n    }\n\n    this.state = {\n      value: {\n        data: ref(data)\n      },\n      appIsMounted: false\n    };\n\n    this.state.value.data.on('set', () => {\n      if (typeof window != undefined) {\n        akasha.set('data', this.state.value.data.get())\n      }\n\n      if (lock) {\n        return\n      }\n\n      lock = true\n\n      requestAnimationFrame(() => {\n        lock = false\n        this.setState({\n          value: {\n            data: this.state.value.data\n          }\n        })\n      })\n    })\n  }\n\n  componentDidMount() {\n    console.log('Ref Provider Mounted')\n    this.setState({ appIsMounted: true });\n  }\n\n  render() {\n    let newProps = Object.assign({}, this.props)\n\n    return <RefContext.Provider value={ this.state.value }>\n        { this.state.appIsMounted ? (\n            this.props.children\n          ) : (\n            <div />\n          )\n        }\n      </RefContext.Provider>\n  }\n}\n\nexport let watch = (key) => {\n  return (WrappedComponent) => {\n    return class WatchedComponent extends React.Component {\n      constructor(props) {\n        super(props)\n      }\n\n      componentWillUnmount() {\n        if (this.data) {\n          this.data.destroy()\n        }\n      }\n\n      render() {\n        let props = this.props\n        let newProps = Object.assign({}, props)\n\n        return (\n          <RefContext.Consumer>\n            { ({ data }) => {\n              // prioritize props.data over context data field\n              let contextData = data\n              if (this.data) {\n                contextData = this.data\n              } else if (props.data) {\n                contextData = props.data\n              }\n\n              // avoid duplication\n              if (!this.data) {\n                // key essentially namespaces the data, either namespace the\n                // context free one from the Ref context or a contexualized one\n                // from props\n                if (key) {\n                  if (props.data) {\n                    contextData = this.data = props.data.ref(key)\n                  } else {\n                    contextData = this.data = data.ref(key)\n                  }\n                }\n              }\n\n              return <WrappedComponent {...newProps} rootData={ data } data={ contextData } />\n            }}\n          </RefContext.Consumer>\n        )\n      }\n    }\n  }\n}\n"],"names":["RefContext","React","createContext","ref","lock","RefProvider","Component","constructor","props","data","window","akasha","get","state","value","appIsMounted","on","undefined","set","requestAnimationFrame","setState","componentDidMount","console","log","render","newProps","Object","assign","children","watch","key","WrappedComponent","WatchedComponent","componentWillUnmount","destroy","contextData"],"mappings":"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"}